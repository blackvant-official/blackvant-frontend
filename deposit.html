<!DOCTYPE html>
<html lang="en" class="app-loading">
<head>
  <meta charset="UTF-8">
  <title>Deposit Funds ‚Äî BlackVant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Main Styles -->
  <link rel="stylesheet" href="assets/css/style.css">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Clerk Styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/style.css">

  <!-- Clerk Script -->
  <script
    async
    crossorigin="anonymous"
    data-clerk-publishable-key="pk_test_Y29taWMta2FuZ2Fyb28tMjMuY2xlcmsuYWNjb3VudHMuZGV2JA"
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js">
  </script>

  <style>
    .cl-userButtonTrigger {
      border: none !important;
      background: transparent !important;
    }
  </style>
</head>

<body class="dashboard-page">
  <div class="container">

    <!-- Header -->
    <header class="header">
      <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
      <a href="dashboard.html" class="logo">BlackVant</a>

      <div class="user-menu">
        <div id="clerk-user-button"></div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">

      <!-- Sidebar -->
      <nav class="sidebar" id="sidebar">
        <a href="dashboard.html" class="nav-item"><span>üìä</span> Dashboard</a>
        <a href="deposit.html" class="nav-item active"><span>üí∞</span> Deposit Funds</a>
        <a href="withdraw.html" class="nav-item"><span>üí∏</span> Withdraw Earnings</a>
        <a href="transaction-history.html" class="nav-item"><span>üìã</span> Transactions History</a>
        <a href="profile-settings.html" class="nav-item"><span>üë§</span> Profile Settings</a>
        <a href="support.html" class="nav-item"><span>üÜò</span> Support</a>
        <a href="javascript:void(0)" class="nav-item" id="logoutBtn"><span>üö™</span> Logout</a>
      </nav>

      <!-- Deposit Content -->
      <main class="deposit-content">

        <div class="page-header">
          <h1>Deposit Funds</h1>
          <p>Add funds to your investment account</p>
        </div>

        <!-- Payment Details -->
        <div class="payment-methods">
          <div class="methods-grid">
            <label class="method-option selected">
              <input type="radio" checked>
              <div class="method-icon">‚Çø</div>
              <div class="method-info">
                <h3>TRC20 (USDT)</h3>
                <p>Crypto payment</p>
              </div>
            </label>
          </div>

          <div class="method-details">
            <div class="crypto-details active">
              <div class="details-header">
                <div>
                  <h3 class="details-title">TRC20 Payment Details</h3>
                  <p>Send USDT via TRC20 network only</p>
                </div>
                <div class="usdt-price">1 USDT = PKR. 295</div>
              </div>

              <div class="details-grid">
                <div class="detail-item">
                  <div class="detail-label">Network</div>
                  <div class="detail-value">TRC20</div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">Coin</div>
                  <div class="detail-value">USDT Only</div>
                </div>
                <div class="detail-item" style="grid-column: span 2;">
                  <div class="detail-label">Wallet Address</div>
                  <div class="detail-value" id="walletAddress">
                    TAb6RFK1RZ1gCwwgT1CGUJ9jF5cF5s5X5v
                  </div>
                  <button class="copy-btn" id="copyAddressBtn">Copy Address</button>
                </div>
              </div>

              <div class="instructions">
                <h4>Instructions:</h4>
                <ul>
                  <li>Send only USDT via TRC20 network</li>
                  <li>Minimum deposit: $100</li>
                  <li>Upload transaction proof</li>
                  <li>Manual verification required</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Deposit Form -->
        <div class="deposit-form">
          <div class="form-group">
            <label class="form-label">Amount (USD)</label>
            <input type="number" id="amount" class="form-input" min="100">
            <div class="error-message" id="amountError">Minimum deposit amount is $100</div>
          </div>

          <div class="form-group">
            <label class="form-label">Upload Receipt</label>
            <div class="upload-area" id="uploadArea">
              <div class="upload-icon">üìÅ</div>
              <div class="upload-text">Click or drag & drop</div>
              <div class="upload-hint">JPG, PNG, PDF</div>
              <input type="file" id="fileInput" class="file-input" accept=".jpg,.jpeg,.png,.pdf">
            </div>

            <div class="file-preview" id="filePreview">
              <div class="file-info">
                <span id="fileName"></span>
                <button id="removeFileBtn" class="remove-file">√ó</button>
              </div>
            </div>
          </div>

          <button class="btn-primary" id="submitBtn" disabled>
            Submit Deposit Request
          </button>
        </div>

      </main>
    </div>
  </div>

  <!-- Scripts -->
  <script src="assets/js/config.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/dashboard.js"></script>
  <script src="assets/js/transactions.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      requireAuth({
        redirectTo: "login.html",
        onReady: async () => {

          let isFileUploaded = false;

          const amountInput = document.getElementById("amount");
          const amountError = document.getElementById("amountError");
          const submitBtn = document.getElementById("submitBtn");

          const fileInput = document.getElementById("fileInput");
          const filePreview = document.getElementById("filePreview");
          const fileName = document.getElementById("fileName");
          const uploadArea = document.getElementById("uploadArea");
          const removeFileBtn = document.getElementById("removeFileBtn");

          function validateDepositForm() {
            const amount = Number(amountInput.value);
            const amountValid = amount >= 100;

            amountError.style.display = amountValid ? "none" : "block";
            submitBtn.disabled = !(amountValid && isFileUploaded);
          }

          uploadArea.addEventListener("click", () => fileInput.click());

          fileInput.addEventListener("change", () => {
            if (fileInput.files.length > 0) {
              fileName.textContent = fileInput.files[0].name;
              filePreview.style.display = "block";
              isFileUploaded = true;
              validateDepositForm();
            }
          });

          removeFileBtn.addEventListener("click", () => {
            fileInput.value = "";
            filePreview.style.display = "none";
            isFileUploaded = false;
            validateDepositForm();
          });

          amountInput.addEventListener("input", validateDepositForm);

          submitBtn.addEventListener("click", async () => {
            if (!isFileUploaded) {
              alert("Please upload payment proof before submitting.");
              return;
            }
            if (Number(amountInput.value) < 100) return;

            const token = await getAuthToken();
            if (!token) return alert("Authentication failed");

            await fetch(`${window.API_BASE_URL}/api/v1/deposit`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`
              },
              body: JSON.stringify({
                amount: Number(amountInput.value),
                method: "TRC20",
                currency: "USD"
              })
            });

            alert("Deposit submitted successfully.");
            submitBtn.disabled = true;
          });

          validateDepositForm();
        }
      });
    });
  </script>

</body>
</html>
